{"version":3,"file":"asbestos.js","sources":["_js/asbestos.js"],"sourcesContent":["class Asbestos {\n    constructor() {\n        this.list = [];\n        this.dialog       = null\n        this.displayPanel = null;\n    }\n\n    init() {\n        document.body.insertAdjacentHTML('afterBegin', `<div id=\"osha-it\">\n            <header><span>DANGER!</span><button>+</button></header>\n            <H1><b>Caution!</b> Achtung! Precauc√≠on!</H1>\n            <div>\n                <span class=\"osha\"></span>\n                <span class=\"oshacopy\">\n                    <h2>A.S.B.E.S.T.O.S.</h2>\n                    <h3>ASSOCIATES SAND-BAGGING EVERYONES STORY TOTALS: ONGOING SPRINT</h3>\n        \n                    <ul id=\"asbestlist\">\n                        <b>Everybody's burning! We're good!</b>\n                    </ul>\n                </span>\n            </div>\n        </div>\n        <div class=\"osha-blotter\"></div>`);\n        this.dialog       = document.querySelector(\"#osha-it\");\n        this.displayPanel = document.querySelector(\"#asbestlist\");\n        this.dialog.querySelector('button').addEventListener('click', ()=>this.hideAsbestos());\n        window.setTimeout(()=>window.document.querySelector('.asbestos-trigger').addEventListener('click', ()=>window.asbestos.showAsbestos()), 3000);\n\n    }\n\n    showAsbestos(text = this.buildShitlist()) {\n        if(text == null || text === \"\") return;\n        let opPanel = document.querySelector(\"#asbestlist\");\n        opPanel.innerHTML = `<b>The following people have not burned this sprint:</b>${text}`;\n        this.dialog.className = 'visible';\n    }\n\n    hideAsbestos() {\n        this.dialog.className = '';\n    }\n\n    buildShitlist() {\n        let sequences = {},\n            assignees = [];\n        fileBuffer\n            .flatMap((r) => r.fileData)\n            .forEach((issue) => {\n                if (\n                    issue == null ||\n                    typeof issue[\"Issue key\"] === \"undefined\"\n                ) {\n                    return;\n                }\n                assignees.push(issue[\"Assignee\"]);\n                var iss = issue[\"Issue key\"];\n                if (sequences[iss]) {\n                    sequences[iss].push(issue);\n                } else sequences[iss] = [issue];\n            });\n        assignees = [...new Set(assignees)];\n        Object.values(sequences).forEach((seq) => {\n            var startingEstHours = seq[0][\"Remaining Estimate\"],\n                hoursBurnedAtSomePoint = seq.some(\n                    (day) => day[\"Remaining Estimate\"] < startingEstHours\n                ),\n                finalAssignee = seq.reverse()[0][\"Assignee\"];\n            seq.reverse();\n            if (\n                hoursBurnedAtSomePoint &&\n                assignees.indexOf(finalAssignee) !== -1\n            )\n                assignees.splice(assignees.indexOf(finalAssignee), 1);\n        });\n        let rval = assignees.length > 0 ? teamDialog.performSubstitution(`<li>${assignees.join(\"</li><li>\")}</li>`) : '';\n        // console.log('rval :', rval);\n        return rval;\n    }\n}\n\nwindow.asbestos = new Asbestos();"],"names":["Asbestos","constructor","list","dialog","displayPanel","init","document","body","insertAdjacentHTML","querySelector","addEventListener","hideAsbestos","window","setTimeout","asbestos","showAsbestos","text","buildShitlist","opPanel","innerHTML","className","sequences","assignees","fileBuffer","flatMap","r","fileData","forEach","issue","push","iss","Set","Object","values","seq","startingEstHours","hoursBurnedAtSomePoint","some","day","finalAssignee","reverse","indexOf","splice","rval","length","teamDialog","performSubstitution","join"],"mappings":"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"}